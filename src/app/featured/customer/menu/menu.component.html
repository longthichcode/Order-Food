<app-customer-header></app-customer-header>
<div class="container mt-4">
  <!-- Tiêu đề -->
  <div class="text-center mb-5">
    <h2 class="fw-bold display-6">Thực Đơn</h2>
    <p class="text-muted">Khám phá những món ăn ngon với hương vị đặc trưng của ẩm thực Việt Nam</p>
  </div>

  <!-- Bộ lọc -->
  <div *ngIf="!loading" class="row mb-4 g-3">
    <!-- Tìm theo tên -->
    <div class="col-md-4 col-12">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Tìm kiếm món ăn</mat-label>
        <input matInput placeholder="Nhập tên món..." (input)="searchByName($event)">
      </mat-form-field>
    </div>

    <!-- Danh mục -->
    <div class="col-md-4 col-12">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Danh mục</mat-label>
        <mat-select [(ngModel)]="selectedCategory" (selectionChange)="filterByCategory($event.value)">
          <mat-option value="0">Tất cả</mat-option>
          <mat-option *ngFor="let category of listCategory" [value]="category.categoryId">
            {{ category.categoryName }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Mức giá -->
    <div class="col-md-4 col-12">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Mức giá</mat-label>
        <mat-select [(ngModel)]="filterPrice" (selectionChange)="applyFilters()">
          <mat-option value="">Tất cả</mat-option>
          <mat-option value="low">Dưới 30.000đ</mat-option>
          <mat-option value="mid">30.000đ - 70.000đ</mat-option>
          <mat-option value="high">Trên 70.000đ</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary"></div>
    <p class="mt-3">Đang tải dữ liệu...</p>
  </div>

  <!-- Lỗi -->
  <div *ngIf="messageErr" class="alert alert-danger text-center">
    {{ messageErr }}
  </div>

  <!-- Danh sách món ăn -->
  <div class="row g-4">
    <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12" *ngFor="let food of allFoods">
      <div class="card food-card h-100 shadow-sm">
        <div class="img-wrapper">
          <img [src]="'assets/' + food.imageUrl" class="card-img-top food-img" alt="{{ food.name }}">
          <span class="badge bg-danger new-badge" *ngIf="food.isPromotion"><i class="bi bi-percent"></i> Khuyến
            mãi</span>
        </div>
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title fw-bold mb-0">{{ food.name }}</h5>
            <span class="badge bg-light border text-dark p-2">{{ food.category?.categoryName }}</span>
          </div>
          <p class="card-text text-muted small flex-grow-1 p-0 m-0" style="color: rgba(161, 161, 161, 0.237);">{{
            food.description }}</p>
          <div class="d-flex justify-content-between align-items-center">
            <span class="fw-bold text-danger price-tag">{{ formatPrice(food.price) }}</span>
            <span class="badge" [ngClass]="food.status === 'AVAILABLE' ? 'text-success' : 'text-danger'">
              {{ food.status === 'AVAILABLE' ? 'Còn hàng' : 'Hết hàng' }}
            </span>
          </div>
        </div>
        <div class="card-footer bg-white text-center">
          <button mat-raised-button color="primary" class="btn-animated" [disabled]="food.status !== 'AVAILABLE'"
            (click)="toggleCartForm(food.foodId)">
            <i class="bi bi-cart3"></i> Thêm vào giỏ
          </button>
          <!-- Form nhập số lượng và lưu ý -->
          <div *ngIf="selectedFoodId === food.foodId" class="mt-3">
            <div class="mb-2 text-start">
              <label class="form-label small">Số lượng</label>
              <input type="number" min="1" [(ngModel)]="quantity" class="form-control form-control-sm">
            </div>
            <div class="mb-2 text-start">
              <label class="form-label small">Lưu ý</label>
              <input type="text" [(ngModel)]="note" class="form-control form-control-sm"
                placeholder="Ví dụ: ít cay, thêm rau...">
            </div>
            <button class="btn btn-success btn-sm w-100" (click)="addToCart(food.foodId, quantity, note)">
              Xác nhận
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>